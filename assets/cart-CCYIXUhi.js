var j=e=>{throw TypeError(e)};var E=(e,t,s)=>t.has(e)||j("Cannot "+s);var r=(e,t,s)=>(E(e,t,"read from private field"),s?s.call(e):t.get(e)),b=(e,t,s)=>t.has(e)?j("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),f=(e,t,s,i)=>(E(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s),g=(e,t,s)=>(E(e,t,"access private method"),s);import{K as B,L as K,M as P,N as k,O as w,P as A,r as v,Q as L,R as T,H as U,V as D,u as N,W,j as x,S as _,y as q}from"./index-DnJbiKHO.js";import{A as z,B as F,P as I}from"./active-all-panel-COdrJTnA.js";import{B as Q}from"./Button-DDBuvE4j.js";var l,c,a,u,h,O,S,R,V=(R=class extends B{constructor(t,s){super();b(this,h);b(this,l);b(this,c);b(this,a);b(this,u);f(this,l,t),this.setOptions(s),this.bindMethods(),g(this,h,O).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var i;const s=this.options;this.options=r(this,l).defaultMutationOptions(t),K(this.options,s)||r(this,l).getMutationCache().notify({type:"observerOptionsUpdated",mutation:r(this,a),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&P(s.mutationKey)!==P(this.options.mutationKey)?this.reset():((i=r(this,a))==null?void 0:i.state.status)==="pending"&&r(this,a).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=r(this,a))==null||t.removeObserver(this)}onMutationUpdate(t){g(this,h,O).call(this),g(this,h,S).call(this,t)}getCurrentResult(){return r(this,c)}reset(){var t;(t=r(this,a))==null||t.removeObserver(this),f(this,a,void 0),g(this,h,O).call(this),g(this,h,S).call(this)}mutate(t,s){var i;return f(this,u,s),(i=r(this,a))==null||i.removeObserver(this),f(this,a,r(this,l).getMutationCache().build(r(this,l),this.options)),r(this,a).addObserver(this),r(this,a).execute(t)}},l=new WeakMap,c=new WeakMap,a=new WeakMap,u=new WeakMap,h=new WeakSet,O=function(){var s;const t=((s=r(this,a))==null?void 0:s.state)??k();f(this,c,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},S=function(t){w.batch(()=>{var s,i,n,d,o,p,y,M;if(r(this,u)&&this.hasListeners()){const m=r(this,c).variables,C=r(this,c).context;(t==null?void 0:t.type)==="success"?((i=(s=r(this,u)).onSuccess)==null||i.call(s,t.data,m,C),(d=(n=r(this,u)).onSettled)==null||d.call(n,t.data,null,m,C)):(t==null?void 0:t.type)==="error"&&((p=(o=r(this,u)).onError)==null||p.call(o,t.error,m,C),(M=(y=r(this,u)).onSettled)==null||M.call(y,void 0,t.error,m,C))}this.listeners.forEach(m=>{m(r(this,c))})})},R);function H(e,t){const s=A(),[i]=v.useState(()=>new V(s,e));v.useEffect(()=>{i.setOptions(e)},[i,e]);const n=v.useSyncExternalStore(v.useCallback(o=>i.subscribe(w.batchCalls(o)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),d=v.useCallback((o,p)=>{i.mutate(o,p).catch(L)},[i]);if(n.error&&T(i.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:d,mutateAsync:n.mutate}}const Y=[],$={root:{minWidth:"fit-content",maxWidth:400,margin:"0 auto",background:"var(--app-highlight-gradient)"},label:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"}};function tt(){const{dataByScope:e}=U(),{added:t,total:s,list:i}=D(),n=N(),d=H({mutationFn:W.orders.create,onSuccess:()=>{n.navigate({to:"/finish"})},onError:o=>{q(`Ошибка при создании заказа: ${o.message}`,{type:"error"})}});return x.jsxs(_,{gap:"xl",children:[x.jsx(z,{defaultValue:Y,items:Object.entries(e).map(([o,p])=>[o,p.filter(y=>t.has(y.id))])}),x.jsxs(Q,{onClick:()=>d.mutate(i),variant:"gradient",size:"xl",styles:$,radius:"xl",loading:d.isPending,children:["Оформить",x.jsx(F,{size:"xl",variant:"transparent",color:"var(--mantine-font-color)",children:x.jsx(I,{value:s})})]})]})}export{tt as default};
